From 0f4de58c3478d38cc261e6025142881afebf0b5b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Tue, 17 Mar 2015 01:33:25 +0100
Subject: [PATCH] native: build and install icemaker only
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Upstream-Status: Inappropriate [embedded-specific]

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@googlemail.com>
---
 CMakeLists.txt         | 7 ++-----
 src/CMakeLists.txt     | 1 -
 src/kjs/CMakeLists.txt | 3 +++
 3 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 11120f7..b6f277a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -51,12 +51,9 @@ option(KJS_FORCE_DISABLE_PCRE "Force building of KJS without PCRE. Doing this wi
 # TODO: Remove these
 remove_definitions(-DQT_NO_CAST_FROM_ASCII)
 
-find_package(KF5DocTools ${KF5_DEP_VERSION} REQUIRED)
+#find_package(KF5DocTools ${KF5_DEP_VERSION} REQUIRED)
 
 add_subdirectory(src)
-add_subdirectory(autotests)
-add_subdirectory(tests)
-add_subdirectory(docs)
 
 # create a Config.cmake and a ConfigVersion.cmake file and install them
 set(CMAKECONFIG_INSTALL_DIR "${KDE_INSTALL_CMAKEPACKAGEDIR}/KF5JS")
@@ -77,7 +74,7 @@ install(EXPORT KF5JSTargets DESTINATION "${CMAKECONFIG_INSTALL_DIR}" FILE KF5JST
 
 install(FILES ${CMAKE_CURRENT_BINARY_DIR}/kjs_version.h DESTINATION ${KDE_INSTALL_INCLUDEDIR_KF5} COMPONENT Devel )
 
-kdoctools_install(po)
+#kdoctools_install(po)
 
 if ("${CMAKE_BINARY_DIR}" STREQUAL "${CMAKE_CURRENT_BINARY_DIR}")
     feature_summary(WHAT ALL FATAL_ON_MISSING_REQUIRED_PACKAGES)
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index de1d59f..ad1af7e 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -1,3 +1,2 @@
 add_subdirectory(kjs)
 
-add_subdirectory(wtf)
diff --git a/src/kjs/CMakeLists.txt b/src/kjs/CMakeLists.txt
index a51a71d..fc74820 100644
--- a/src/kjs/CMakeLists.txt
+++ b/src/kjs/CMakeLists.txt
@@ -68,6 +68,8 @@ endif()
    ecm_mark_nongui_executable(icemaker)
    target_include_directories(icemaker PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/..")
 
+   install(TARGETS icemaker EXPORT KF5JSTargets ${KF5_INSTALL_TARGETS_DEFAULT_ARGS})
+if(FALSE)
    # get the name of the generated wrapper script (which sets up LD_LIBRARY_PATH)
    #get_target_property(ICEMAKER_EXECUTABLE icemaker WRAPPER_SCRIPT)
    #get_target_property(ICEMAKER_EXECUTABLE_DIR icemaker RUNTIME_OUTPUT_DIRECTORY)
@@ -310,6 +312,7 @@ install(FILES
 )
 
 install(FILES create_hash_table DESTINATION ${KDE_INSTALL_DATADIR_KF5}/kjs/ )
+endif()
 
 include(ECMGeneratePriFile)
 ecm_generate_pri_file(BASE_NAME KJS LIB_NAME KF5JS DEPS "core" FILENAME_VAR PRI_FILENAME INCLUDE_INSTALL_DIR ${KDE_INSTALL_INCLUDEDIR_KF5}/KJS)
-- 
2.10.2

